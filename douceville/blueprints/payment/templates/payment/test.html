{%- extends "bootstrap/base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block head %}
<script src="https://js.stripe.com/v3"></script>
{% endblock %}

{% block title %}
    {% if title %}Douceville{% endif %}
{% endblock %}

{% block content %}
<div class="container">
    {% block app_content %}
    <h1>Test</h1>
    <div class="row">
        <div class="col-md-4">
            <!-- Create a button that your customers click to complete their purchase. Customize the styling to suit your branding. -->
            <button
            style="background-color:#6772E5;color:#FFF;padding:8px 12px;border:0;border-radius:4px;font-size:1em"
            id="checkout-button-price_1Hla0OGFonhtEiXEzvSy3D0J"
            role="link"
            type="button"
            >
            Checkout
            </button>

            <div id="error-message"></div>

            <script>
            (function() {
            var stripe = Stripe('{{ key }}');

            var checkoutButton = document.getElementById('checkout-button-price_1Hla0OGFonhtEiXEzvSy3D0J');
            checkoutButton.addEventListener('click', function () {
            // When the customer clicks on the button, redirect
            // them to Checkout.
            stripe.redirectToCheckout({
                lineItems: [{price: 'price_1Hla0OGFonhtEiXEzvSy3D0J', quantity: 1}],
                mode: 'payment',
                customerEmail: '{{ user_email }}',
                // Do not rely on the redirect to the successUrl for fulfilling
                // purchases, customers may not always reach the success_url after
                // a successful payment.
                // Instead use one of the strategies described in
                // https://stripe.com/docs/payments/checkout/fulfill-orders
                successUrl: 'https://douceville.fr/checkout',
                cancelUrl: 'https://douceville.fr/canceled',
            })
            .then(function (result) {
                if (result.error) {
                // If `redirectToCheckout` fails due to a browser or network
                // error, display the localized error message to your customer.
                var displayError = document.getElementById('error-message');
                displayError.textContent = result.error.message;
                }
            });
            });
            })();
            </script>
        </div>
    </div>
    {% endblock %}
</div>
{% endblock %}
