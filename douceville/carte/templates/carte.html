{%- extends "base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}

{% block head %}
    {{super()}}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
{% endblock %}

  
{% block content %}
<div class="container">
  {% block app_content %}
    <!--<div id="rescountid"></div>-->
    <div id="mapid" style="width: 100%; height: 600px;"></div>
    <script>

      var mymap = L.map('mapid').setView([47.0382686, 1.1501905], 6);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(mymap);
      
      function onEachFeature(feature, layer) {
          // does this feature have a property named info?
          if (feature.properties && feature.properties.info) {
              layer.bindPopup(feature.properties.info);
          }
      }

      axios.get('{{ api_url }}', headers: {
        Authorization: 'Bearer {{ api_key }}'
      })
      .then(response => {
          // console.log(response.data);
          // document.getElementById("rescountid").innerHTML = 'Nombre de r√©sultats : ' + response.data.length;
          L.geoJSON(response.data.etablissements, {onEachFeature: onEachFeature}).addTo(mymap);

          var bb1 = [response.isochrone.data.bbox[1], response.isochrone.data.bbox[0]];
          var bb2 = [response.isochrone.data.bbox[3], response.isochrone.data.bbox[2]];
          L.geoJSON(response.isochrone.data).addTo(mymap);
          mymap.fitBounds([bb1,bb2]);

      })
      
    </script>
    
    {% endblock %}
</div>
{{super()}}
{% endblock %}

